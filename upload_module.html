<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WipeTrace — Forensic Analysis</title>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Syne:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0a0b0d;
        --surface: #101214;
        --panel: #14171a;
        --border: #1e2227;
        --border-hi: #2a2f36;
        --accent: #e8ff47;
        --accent-lo: rgba(232, 255, 71, 0.07);
        --accent-md: rgba(232, 255, 71, 0.15);
        --red: #ff4d4d;
        --red-lo: rgba(255, 77, 77, 0.08);
        --teal: #00c8a0;
        --teal-lo: rgba(0, 200, 160, 0.08);
        --muted: #3a4048;
        --dim: #5c636e;
        --text: #c8cdd4;
        --text-hi: #e8ecf0;
        --text-lo: #4a5260;
        --mono: "JetBrains Mono", monospace;
        --sans: "Syne", sans-serif;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        background: var(--bg);
        color: var(--text);
        font-family: var(--mono);
        font-size: 13px;
        line-height: 1.6;
        overflow-x: hidden;
        overflow-y: auto;
      }

      /* Scanline overlay */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: repeating-linear-gradient(
          0deg,
          transparent,
          transparent 3px,
          rgba(0, 0, 0, 0.04) 3px,
          rgba(0, 0, 0, 0.04) 4px
        );
        pointer-events: none;
        z-index: 9999;
      }

      /* ── Layout ── */
      .shell {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* ── Nav Bar ── */
      nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 40px;
        height: 56px;
        border-bottom: 1px solid var(--border);
        background: var(--surface);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .nav-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: var(--sans);
        font-weight: 800;
        font-size: 16px;
        letter-spacing: -0.02em;
        color: var(--text-hi);
      }

      .nav-logo-mark {
        width: 28px;
        height: 28px;
        background: var(--accent);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .nav-logo-mark svg {
        width: 16px;
        height: 16px;
      }

      .nav-meta {
        display: flex;
        align-items: center;
        gap: 24px;
      }

      .status-dot {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
        color: var(--dim);
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--teal);
        box-shadow: 0 0 6px var(--teal);
        animation: pulse 2.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }

      .nav-version {
        font-size: 11px;
        color: var(--text-lo);
        letter-spacing: 0.08em;
      }

      /* ── Step Breadcrumb ── */
      .step-bar {
        display: flex;
        align-items: center;
        padding: 0 40px;
        height: 44px;
        background: var(--panel);
        border-bottom: 1px solid var(--border);
        gap: 0;
      }

      .step-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 16px 0 0;
        font-size: 11px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: var(--text-lo);
      }

      .step-item.active {
        color: var(--accent);
      }

      .step-item.done {
        color: var(--teal);
      }

      .step-num {
        width: 18px;
        height: 18px;
        border-radius: 3px;
        border: 1px solid currentColor;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
        flex-shrink: 0;
      }

      .step-item.active .step-num {
        background: var(--accent);
        color: #000;
        border-color: var(--accent);
      }

      .step-arrow {
        color: var(--border-hi);
        margin: 0 8px;
        font-size: 12px;
      }

      /* ── Main Content ── */
      .main {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 340px;
        gap: 0;
        min-height: 0;
        overflow-y: auto;
      }

      /* ── Upload Zone ── */
      .upload-zone {
        padding: 48px 48px 56px;
        display: flex;
        flex-direction: column;
        gap: 28px;
        border-right: 1px solid var(--border);
        overflow-y: auto;
      }

      .section-label {
        font-size: 10px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--dim);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-label::after {
        content: "";
        flex: 1;
        height: 1px;
        background: var(--border);
      }

      .upload-header h1 {
        font-family: var(--sans);
        font-size: 28px;
        font-weight: 700;
        color: var(--text-hi);
        letter-spacing: -0.02em;
        line-height: 1.2;
        margin-bottom: 8px;
      }

      .upload-header h1 span {
        color: var(--accent);
      }

      .upload-header p {
        color: var(--dim);
        font-size: 12px;
        line-height: 1.7;
        max-width: 480px;
      }

      /* ── Drop Area ── */
      .dropzone {
        position: relative;
        border: 1.5px dashed var(--border-hi);
        border-radius: 8px;
        padding: 52px 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: var(--panel);
        overflow: hidden;
        min-height: 240px;
      }

      /* corner brackets — industrial targeting feel */
      .dropzone::before,
      .dropzone::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .dropzone::before {
        background: radial-gradient(
          ellipse at 50% 80%,
          var(--accent-lo) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      /* corner bracket overlay using box-shadow trick */
      .dropzone-corners {
        position: absolute;
        inset: 10px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.25s ease;
      }
      .dropzone-corners::before,
      .dropzone-corners::after {
        content: "";
        position: absolute;
        width: 14px;
        height: 14px;
        border-color: var(--accent);
        border-style: solid;
        opacity: 0.6;
      }
      .dropzone-corners::before {
        top: 0;
        left: 0;
        border-width: 2px 0 0 2px;
      }
      .dropzone-corners::after {
        bottom: 0;
        right: 0;
        border-width: 0 2px 2px 0;
      }

      .dropzone:hover .dropzone-corners,
      .dropzone.drag-over .dropzone-corners {
        opacity: 1;
      }

      .dropzone:hover,
      .dropzone.drag-over {
        border-color: var(--accent);
        background: var(--surface);
      }

      .dropzone:hover::before,
      .dropzone.drag-over::before {
        opacity: 1;
      }

      /* accepted state — file successfully dropped */
      .dropzone.accepted {
        border-color: var(--teal);
        border-style: solid;
        background: var(--surface);
      }
      .dropzone.accepted::before {
        background: radial-gradient(
          ellipse at 50% 80%,
          var(--teal-lo) 0%,
          transparent 70%
        );
        opacity: 1;
      }
      .dropzone.accepted .dropzone-icon {
        border-color: var(--teal);
        box-shadow: 0 0 20px rgba(0, 200, 160, 0.2);
      }
      .dropzone.accepted .dropzone-icon svg {
        stroke: var(--teal);
      }

      .dropzone-icon {
        width: 56px;
        height: 56px;
        border: 1.5px solid var(--border-hi);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--surface);
        transition: all 0.2s ease;
        position: relative;
        z-index: 1;
      }

      .dropzone:hover .dropzone-icon,
      .dropzone.drag-over .dropzone-icon {
        border-color: var(--accent);
        box-shadow: 0 0 20px var(--accent-md);
      }

      .dropzone-icon svg {
        width: 24px;
        height: 24px;
        stroke: var(--dim);
        transition: stroke 0.2s;
      }

      .dropzone:hover .dropzone-icon svg,
      .dropzone.drag-over .dropzone-icon svg {
        stroke: var(--accent);
      }

      .dropzone-text {
        text-align: center;
        position: relative;
        z-index: 1;
      }

      .dropzone-text strong {
        display: block;
        color: var(--text-hi);
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .dropzone-text span {
        color: var(--dim);
        font-size: 11px;
      }

      .dropzone-text .browse-link {
        color: var(--accent);
        cursor: pointer;
        text-decoration: none;
      }

      .file-types {
        display: flex;
        gap: 6px;
        position: relative;
        z-index: 1;
      }

      .file-tag {
        padding: 3px 8px;
        border: 1px solid var(--border-hi);
        border-radius: 3px;
        font-size: 10px;
        letter-spacing: 0.06em;
        color: var(--text-lo);
        background: var(--surface);
      }

      .dropzone-limit {
        position: absolute;
        bottom: 12px;
        right: 16px;
        font-size: 10px;
        color: var(--text-lo);
        letter-spacing: 0.04em;
      }

      input[type="file"] {
        display: none;
      }

      /* ── OR Divider ── */
      .or-divider {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--text-lo);
        font-size: 10px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
      }

      .or-divider::before,
      .or-divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background: var(--border);
      }

      /* ── Path Input ── */
      .path-input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .input-label {
        font-size: 10px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--dim);
      }

      .path-row {
        display: flex;
        gap: 8px;
      }

      .path-input {
        flex: 1;
        background: var(--panel);
        border: 1px solid var(--border-hi);
        border-radius: 5px;
        padding: 10px 14px;
        color: var(--text);
        font-family: var(--mono);
        font-size: 12px;
        outline: none;
        transition: border-color 0.2s;
      }

      .path-input::placeholder {
        color: var(--text-lo);
      }

      .path-input:focus {
        border-color: var(--accent);
      }

      .path-btn {
        padding: 10px 16px;
        border-radius: 5px;
        border: 1px solid var(--border-hi);
        background: var(--surface);
        color: var(--text);
        font-family: var(--mono);
        font-size: 11px;
        cursor: pointer;
        transition: all 0.2s;
        letter-spacing: 0.04em;
        white-space: nowrap;
      }

      .path-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      /* ── File Preview Card ── */
      .file-card {
        display: flex;
        background: var(--panel);
        border: 1px solid var(--border-hi);
        border-left: 3px solid var(--teal);
        border-radius: 6px;
        padding: 16px 18px;
        gap: 14px;
        align-items: center;
        opacity: 0;
        transform: translateY(-6px);
        max-height: 0;
        overflow: hidden;
        pointer-events: none;
        padding-top: 0;
        padding-bottom: 0;
        transition:
          opacity 0.28s ease,
          transform 0.28s ease,
          max-height 0.32s ease,
          padding 0.28s ease;
      }

      .file-card.visible {
        opacity: 1;
        transform: translateY(0);
        max-height: 100px;
        pointer-events: auto;
        padding-top: 16px;
        padding-bottom: 16px;
      }

      .file-card-icon {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        background: var(--teal-lo);
        border: 1px solid rgba(0, 200, 160, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .file-card-icon svg {
        width: 18px;
        height: 18px;
        stroke: var(--teal);
      }

      .file-card-info {
        flex: 1;
        min-width: 0;
      }

      .file-card-name {
        color: var(--text-hi);
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 2px;
      }

      .file-card-meta {
        display: flex;
        gap: 16px;
      }

      .file-card-meta span {
        font-size: 10px;
        color: var(--dim);
        letter-spacing: 0.04em;
      }

      .file-card-meta span strong {
        color: var(--teal);
      }

      .file-remove {
        background: none;
        border: none;
        color: var(--muted);
        cursor: pointer;
        padding: 4px;
        border-radius: 3px;
        transition: color 0.2s;
        font-family: var(--mono);
        font-size: 16px;
        line-height: 1;
      }

      .file-remove:hover {
        color: var(--red);
      }

      /* ── Progress Bar ── */
      .upload-progress {
        display: none;
        flex-direction: column;
        gap: 8px;
      }

      .upload-progress.visible {
        display: flex;
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        color: var(--dim);
      }

      .progress-header span:last-child {
        color: var(--accent);
        font-weight: 600;
      }

      .progress-track {
        height: 5px;
        background: var(--border);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--teal), var(--accent));
        border-radius: 3px;
        width: 0%;
        transition: width 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.28) 50%,
          transparent 100%
        );
        transform: translateX(-100%);
        animation: shimmer 1.6s ease-in-out infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(300%);
        }
      }

      .progress-fill.done::after {
        display: none;
      }

      .progress-stages {
        display: flex;
        gap: 4px;
      }

      .stage-pill {
        padding: 2px 8px;
        border-radius: 2px;
        font-size: 9px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        background: var(--surface);
        border: 1px solid var(--border);
        color: var(--text-lo);
        transition: all 0.3s;
      }

      .stage-pill.active {
        background: var(--accent-lo);
        border-color: var(--accent);
        color: var(--accent);
      }

      .stage-pill.done {
        background: var(--teal-lo);
        border-color: rgba(0, 200, 160, 0.3);
        color: var(--teal);
      }

      /* ── Action Button ── */
      .action-row {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .btn-primary {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 28px;
        background: var(--accent);
        color: #000;
        border: none;
        border-radius: 5px;
        font-family: var(--mono);
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary:hover {
        background: #f5ff6e;
        transform: translateY(-1px);
        box-shadow: 0 4px 20px rgba(232, 255, 71, 0.25);
      }

      .btn-primary:disabled {
        opacity: 0.35;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-primary svg {
        width: 14px;
        height: 14px;
      }

      /* loading state — add class .loading to btn-primary */
      .btn-primary.loading {
        cursor: wait;
        pointer-events: none;
        background: var(--accent);
        position: relative;
        color: transparent; /* hide text — show spinner */
      }

      .btn-primary.loading svg {
        visibility: hidden;
      }

      .btn-primary.loading::after {
        content: "";
        position: absolute;
        width: 14px;
        height: 14px;
        border: 2px solid rgba(0, 0, 0, 0.3);
        border-top-color: #000;
        border-radius: 50%;
        animation: btnSpin 0.7s linear infinite;
      }

      @keyframes btnSpin {
        to {
          transform: rotate(360deg);
        }
      }

      .btn-secondary {
        padding: 12px 20px;
        background: none;
        border: 1px solid var(--border-hi);
        border-radius: 5px;
        color: var(--dim);
        font-family: var(--mono);
        font-size: 11px;
        letter-spacing: 0.04em;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-secondary:hover {
        border-color: var(--text-lo);
        color: var(--text);
      }

      .btn-note {
        font-size: 10px;
        color: var(--text-lo);
        letter-spacing: 0.03em;
      }

      /* ── Right Panel ── */
      .info-panel {
        padding: 32px 28px;
        display: flex;
        flex-direction: column;
        gap: 24px;
        overflow-y: auto;
        background: var(--panel);
      }

      .panel-block {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .panel-block-title {
        font-size: 10px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--dim);
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border);
      }

      /* Supported formats */
      .format-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
      }

      .format-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 5px;
      }

      .format-ext {
        font-size: 10px;
        font-weight: 700;
        color: var(--accent);
        letter-spacing: 0.04em;
        width: 28px;
      }

      .format-desc {
        font-size: 10px;
        color: var(--dim);
      }

      /* What we detect */
      .detect-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .detect-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 5px;
        transition: border-color 0.2s;
      }

      .detect-item:hover {
        border-color: var(--border-hi);
      }

      .detect-badge {
        width: 32px;
        height: 20px;
        border-radius: 2px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        font-weight: 700;
        letter-spacing: 0.04em;
        flex-shrink: 0;
      }

      .badge-zero {
        background: rgba(59, 130, 246, 0.15);
        color: #60a5fa;
        border: 1px solid rgba(59, 130, 246, 0.25);
      }
      .badge-ff {
        background: rgba(234, 179, 8, 0.15);
        color: #facc15;
        border: 1px solid rgba(234, 179, 8, 0.25);
      }
      .badge-rand {
        background: var(--red-lo);
        color: var(--red);
        border: 1px solid rgba(255, 77, 77, 0.25);
      }
      .badge-multi {
        background: rgba(168, 85, 247, 0.15);
        color: #c084fc;
        border: 1px solid rgba(168, 85, 247, 0.25);
      }

      .detect-info strong {
        display: block;
        font-size: 11px;
        color: var(--text);
        margin-bottom: 1px;
      }

      .detect-info span {
        font-size: 10px;
        color: var(--text-lo);
      }

      /* Pipeline preview */
      .pipeline {
        display: flex;
        flex-direction: column;
        gap: 0;
        position: relative;
        padding-left: 10px;
      }

      /* vertical connecting line */
      .pipeline::before {
        content: "";
        position: absolute;
        left: 21px;
        top: 16px;
        bottom: 16px;
        width: 1px;
        background: linear-gradient(
          to bottom,
          var(--accent) 0%,
          var(--border-hi) 30%,
          var(--border) 100%
        );
      }

      .pipeline-step {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 7px 10px;
        border-radius: 4px;
        transition: background 0.15s;
      }

      .pipeline-step:hover {
        background: var(--surface);
      }

      .pipeline-num {
        font-size: 9px;
        color: var(--text-lo);
        width: 16px;
        text-align: right;
        flex-shrink: 0;
      }

      .pipeline-line {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        position: relative;
        flex-shrink: 0;
      }

      .pipeline-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--border-hi);
        border: 1.5px solid var(--border-hi);
        flex-shrink: 0;
        transition: all 0.2s;
        position: relative;
        z-index: 1;
      }

      .pipeline-step.active-step .pipeline-dot {
        background: var(--accent);
        border-color: var(--accent);
        box-shadow: 0 0 8px var(--accent);
      }

      .pipeline-text {
        font-size: 11px;
        color: var(--dim);
        transition: color 0.2s;
      }

      .pipeline-step.active-step .pipeline-text {
        color: var(--text-hi);
        font-weight: 500;
      }

      /* Warning box */
      .warning-box {
        padding: 12px 14px;
        background: rgba(255, 77, 77, 0.05);
        border: 1px solid rgba(255, 77, 77, 0.2);
        border-radius: 5px;
        font-size: 10px;
        color: var(--dim);
        line-height: 1.7;
      }

      .warning-box strong {
        display: block;
        color: var(--red);
        font-size: 10px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        margin-bottom: 4px;
      }

      /* ── Footer Strip ── */
      footer {
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 40px;
        border-top: 1px solid var(--border);
        background: var(--surface);
        font-size: 10px;
        color: var(--text-lo);
        letter-spacing: 0.04em;
      }

      footer .footer-left {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      footer .footer-right {
        color: var(--text-lo);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .session-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 2px 8px;
        background: var(--panel);
        border: 1px solid var(--border-hi);
        border-radius: 3px;
        font-family: var(--mono);
        font-size: 10px;
        color: var(--text);
        letter-spacing: 0.06em;
      }

      .session-badge .s-dot {
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: var(--teal);
        box-shadow: 0 0 4px var(--teal);
      }

      /* ── Transitions ── */
      .fade-in {
        animation: fadeIn 0.4s ease forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Error state */
      .error-msg {
        display: none;
        padding: 10px 14px;
        background: var(--red-lo);
        border: 1px solid rgba(255, 77, 77, 0.25);
        border-radius: 5px;
        font-size: 11px;
        color: var(--red);
        gap: 8px;
        align-items: center;
      }

      .error-msg.visible {
        display: flex;
      }
      .animate-scroll-target {
        transition: background-color 1.2s ease;
      }
      .animate-scroll-target.highlight {
        background-color: rgba(232, 255, 71, 0.12);
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <!-- Nav -->
      <nav>
        <div class="nav-logo">
          <div class="nav-logo-mark">
            <svg
              viewBox="0 0 16 16"
              fill="none"
              stroke="#000"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 3h10v10H3z" />
              <path d="M3 8h3M10 8h3M8 3v3M8 10v3" />
            </svg>
          </div>
          WipeTrace
        </div>
        <div class="nav-meta">
          <div class="status-dot">
            <span class="dot"></span>
            Engine Ready
          </div>
          <span class="nav-version">v1.0.0 — DFIR</span>
        </div>
      </nav>

      <!-- Step Bar -->
      <div class="step-bar">
        <div class="step-item active">
          <div class="step-num">1</div>
          Upload Image
        </div>
        <span class="step-arrow">›</span>
        <div class="step-item">
          <div class="step-num">2</div>
          Scan &amp; Detect
        </div>
        <span class="step-arrow">›</span>
        <div class="step-item">
          <div class="step-num">3</div>
          Analysis Dashboard
        </div>
        <span class="step-arrow">›</span>
        <div class="step-item">
          <div class="step-num">4</div>
          Export Report
        </div>
      </div>

      <!-- Main -->
      <div class="main">
        <!-- Upload Zone -->
        <div class="upload-zone">
          <div class="section-label">Module 01 — Target Acquisition</div>

          <div class="upload-header fade-in">
            <h1>Load Disk <span>Image</span></h1>
            <p>
              Provide a raw disk image or volume for wipe pattern analysis. The
              engine will scan all clusters for overwrite signatures and
              anti-forensic artefacts.
            </p>
          </div>

          <!-- Drop Zone -->
          <div
            class="dropzone fade-in"
            id="dropzone"
            onclick="document.getElementById('fileInput').click()"
          >
            <div class="dropzone-corners"></div>
            <div class="dropzone-icon">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M4 14.5v3A2.5 2.5 0 0 0 6.5 20h11a2.5 2.5 0 0 0 2.5-2.5v-3"
                />
                <polyline points="8 10 12 6 16 10" />
                <line x1="12" y1="6" x2="12" y2="15" />
              </svg>
            </div>
            <div class="dropzone-text">
              <strong>Drop disk image here</strong>
              <span
                >or
                <a
                  class="browse-link"
                  onclick="
                    event.stopPropagation();
                    document.getElementById('fileInput').click();
                  "
                  >browse file system</a
                ></span
              >
            </div>
            <div class="file-types">
              <span class="file-tag">.dd</span>
              <span class="file-tag">.img</span>
              <span class="file-tag">.raw</span>
              <span class="file-tag">.bin</span>
              <span class="file-tag">.e01</span>
            </div>
            <span class="dropzone-limit">Max 8 GB</span>
          </div>

          <input
            type="file"
            id="fileInput"
            accept=".dd,.img,.raw,.bin,.e01,.001"
          />

          <!-- Error -->
          <div class="error-msg" id="errorMsg">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="8" x2="12" y2="12" />
              <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <span id="errorText">File exceeds 8 GB limit.</span>
          </div>

          <!-- File Preview -->
          <div class="file-card" id="fileCard">
            <div class="file-card-icon">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                />
                <polyline points="14 2 14 8 20 8" />
              </svg>
            </div>
            <div class="file-card-info">
              <div class="file-card-name" id="fileName">—</div>
              <div class="file-card-meta">
                <span>Size: <strong id="fileSize">—</strong></span>
                <span>SHA-256: <strong id="fileHash">Computing…</strong></span>
              </div>
            </div>
            <button class="file-remove" id="removeBtn" title="Remove">×</button>
          </div>

          <!-- Progress -->
          <div class="upload-progress" id="uploadProgress">
            <div class="progress-header">
              <span id="progressLabel">Uploading to analysis server…</span>
              <span id="progressPct">0%</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-stages">
              <span class="stage-pill active" id="stage-transfer"
                >Transfer</span
              >
              <span class="stage-pill" id="stage-validate">Validate</span>
              <span class="stage-pill" id="stage-index">Index</span>
              <span class="stage-pill" id="stage-ready">Ready</span>
            </div>
          </div>

          <!-- Actions -->
          <div class="action-row fade-in">
            <button
              class="btn-primary"
              id="analyzeBtn"
              disabled
              onclick="startAnalysis()"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon points="5 3 19 12 5 21 5 3" />
              </svg>
              Begin Analysis
            </button>
            <button class="btn-secondary" onclick="clearAll()">Reset</button>
            <span class="btn-note"
              >Analysis may take several minutes for large images</span
            >
          </div>
        </div>

        <!-- Right Panel -->
        <div class="info-panel">
          <!-- Supported Formats -->
          <div class="panel-block fade-in">
            <div class="panel-block-title">Supported Formats</div>
            <div class="format-grid">
              <div class="format-item">
                <span class="format-ext">.dd</span>
                <span class="format-desc">Raw image</span>
              </div>
              <div class="format-item">
                <span class="format-ext">.img</span>
                <span class="format-desc">Disk image</span>
              </div>
              <div class="format-item">
                <span class="format-ext">.raw</span>
                <span class="format-desc">Binary raw</span>
              </div>
              <div class="format-item">
                <span class="format-ext">.bin</span>
                <span class="format-desc">Binary dump</span>
              </div>
              <div class="format-item">
                <span class="format-ext">.e01</span>
                <span class="format-desc">EnCase</span>
              </div>
              <div class="format-item">
                <span class="format-ext">.001</span>
                <span class="format-desc">Split image</span>
              </div>
            </div>
          </div>

          <!-- What We Detect -->
          <div class="panel-block fade-in">
            <div class="panel-block-title">Detection Signatures</div>
            <div class="detect-list">
              <div class="detect-item">
                <span class="detect-badge badge-zero">00</span>
                <div class="detect-info">
                  <strong>Zero Wipe</strong>
                  <span>0x00 overwrite — single pass</span>
                </div>
              </div>
              <div class="detect-item">
                <span class="detect-badge badge-ff">FF</span>
                <div class="detect-info">
                  <strong>FF Fill</strong>
                  <span>0xFF overwrite pattern</span>
                </div>
              </div>
              <div class="detect-item">
                <span class="detect-badge badge-rand">RND</span>
                <div class="detect-info">
                  <strong>Random Overwrite</strong>
                  <span>Entropy ≈ 8.0 — pseudorandom</span>
                </div>
              </div>
              <div class="detect-item">
                <span class="detect-badge badge-multi">MP</span>
                <div class="detect-info">
                  <strong>Multi-Pass</strong>
                  <span>Alternating entropy bands</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Analysis Pipeline -->
          <div class="panel-block fade-in">
            <div class="panel-block-title">Analysis Pipeline</div>
            <div class="pipeline">
              <div class="pipeline-step active-step">
                <span class="pipeline-num">01</span>
                <div class="pipeline-dot"></div>
                <span class="pipeline-text">Image ingestion &amp; hashing</span>
              </div>
              <div class="pipeline-step">
                <span class="pipeline-num">02</span>
                <div class="pipeline-dot"></div>
                <span class="pipeline-text">4KB block partition</span>
              </div>
              <div class="pipeline-step">
                <span class="pipeline-num">03</span>
                <div class="pipeline-dot"></div>
                <span class="pipeline-text">Shannon entropy per block</span>
              </div>
              <div class="pipeline-step">
                <span class="pipeline-num">04</span>
                <div class="pipeline-dot"></div>
                <span class="pipeline-text">Byte dominance analysis</span>
              </div>
              <div class="pipeline-step">
                <span class="pipeline-num">05</span>
                <div class="pipeline-dot"></div>
                <span class="pipeline-text"
                  >Region aggregation &amp; scoring</span
                >
              </div>
              <div class="pipeline-step">
                <span class="pipeline-num">06</span>
                <div class="pipeline-dot"></div>
                <span class="pipeline-text">Intent classification</span>
              </div>
            </div>
          </div>

          <!-- Warning -->
          <div class="warning-box fade-in">
            <strong>⚠ Evidence Handling</strong>
            Uploaded images are stored temporarily and deleted post-session. Do
            not upload originals without maintaining a verified hash. Ensure
            chain of custody before proceeding.
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer>
        <div class="footer-left">
          <span>WipeTrace DFIR Engine</span>
          <span>Block Size: 4096 bytes</span>
          <span>Threshold: H &gt; 7.8 → RANDOM</span>
        </div>
        <div class="footer-right">
          SESSION
          <span class="session-badge"
            ><span class="s-dot"></span><span id="sessionId">—</span></span
          >
        </div>
      </footer>
    </div>

    <script>
      const MAX_SIZE = 8 * 1024 * 1024 * 1024; // 8GB

      // Drag & Drop
      const dropzone = document.getElementById("dropzone");

      dropzone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropzone.classList.add("drag-over");
      });

      dropzone.addEventListener("dragleave", () => {
        dropzone.classList.remove("drag-over");
      });

      dropzone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropzone.classList.remove("drag-over");
        const file = e.dataTransfer.files[0];
        if (file) processFile(file);
      });

      // File input
      document.getElementById("fileInput").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) processFile(file);
      });

      function processFile(file) {
        clearError();
        resetProgress();

        if (file.size > MAX_SIZE) {
          showError(
            "File exceeds 8 GB maximum size. Please use a disk image ≤ 8 GB for this session.",
          );
          return;
        }

        // Visual: mark dropzone as accepted
        const dz = document.getElementById("dropzone");
        dz.classList.add("accepted");

        // Show file card immediately — hash is pending server response
        document.getElementById("fileName").textContent = file.name;
        document.getElementById("fileSize").textContent = formatBytes(
          file.size,
        );
        // Show path / filename in the info field
        const pathInput = document.getElementById("pathInput");
        if (pathInput) {
          // Use file.path if available (some environments like Electron), otherwise filename
          pathInput.value = file.path || file.name;
        }
        document.getElementById("fileHash").textContent =
          "Computing on server…";
        document.getElementById("fileCard").classList.add("visible");
        document.getElementById("analyzeBtn").disabled = true; // locked until server confirms + returns real hash

        // Real upload to FastAPI — SHA-256 comes back from server
        uploadToServer(file);
      }

      const API_BASE = "http://localhost:8000"; // point to your FastAPI server
      let currentSessionId = null;

      function uploadToServer(file) {
        const progress = document.getElementById("uploadProgress");
        const fill = document.getElementById("progressFill");
        const pct = document.getElementById("progressPct");
        const label = document.getElementById("progressLabel");
        const hashEl = document.getElementById("fileHash");
        const sizeEl = document.getElementById("fileSize");

        progress.classList.add("visible");
        setStage("stage-transfer", "Transferring image to server…");

        const formData = new FormData();
        formData.append("file", file);

        const xhr = new XMLHttpRequest();
        xhr.open("POST", `${API_BASE}/upload`);

        // ── Progress ─────────────────────────────────────
        xhr.upload.addEventListener("progress", (e) => {
          if (!e.lengthComputable) return;
          const percent = (e.loaded / e.total) * 100;
          fill.style.width = percent + "%";
          pct.textContent = Math.floor(percent) + "%";

          if (percent >= 30 && percent < 70)
            setStage("stage-validate", "Validating file integrity…");
          if (percent >= 70 && percent < 95)
            setStage("stage-index", "Indexing block structure…");
        });

        // ── Response handler (this is the part that was failing silently) ──
        xhr.addEventListener("load", () => {
          console.log("[Upload] Response received — Status:", xhr.status);

          try {
            const res = JSON.parse(xhr.responseText);
            console.log("[Upload] Parsed JSON:", res);

            if (xhr.status === 200) {
              currentSessionId = res.session_id;
              document.getElementById("sessionId").textContent = res.session_id;

              sizeEl.textContent = res.size_human;
              hashEl.textContent = res.sha256; // ← this is what you wanted to see

              fill.style.width = "100%";
              fill.classList.add("done"); // stop shimmer
              pct.textContent = "100%";
              setStage("stage-ready", "Image ready for analysis", true);
              document.getElementById("analyzeBtn").disabled = false;

              // Clear the hidden file input so you can re-select the same file if needed
              document.getElementById("fileInput").value = "";
              console.log("[Upload] SUCCESS — UI updated, analysis ready");
              setTimeout(() => {
                const target =
                  document.getElementById("analyzeBtn") ||
                  document.querySelector(".warning-box");
                if (target) {
                  target.scrollIntoView({
                    behavior: "smooth",
                    block: "center",
                  });
                  target.classList.add("highlight");
                  setTimeout(() => target.classList.remove("highlight"), 1800);
                }
              }, 400);
            } else {
              const errMsg =
                res.detail || xhr.statusText || "Unknown server error";
              showError(`Server error: ${errMsg}`);
              resetProgress();
            }
          } catch (err) {
            console.error("[Upload] JSON parse failed:", err);
            showError(
              "Invalid response from server (not JSON). Check backend terminal.",
            );
            resetProgress();
          }
        });

        xhr.addEventListener("error", () => {
          console.error("[Upload] Network error");
          showError(
            "Could not reach the analysis server. Is the backend running on http://localhost:8000?",
          );
          resetProgress();
        });

        xhr.send(formData);
      }

      // ── Stage helper ──
      const STAGE_ORDER = [
        "stage-transfer",
        "stage-validate",
        "stage-index",
        "stage-ready",
      ];
      let currentStageIdx = 0;

      function setStage(targetId, labelText, finish = false) {
        const targetIdx = STAGE_ORDER.indexOf(targetId);
        if (targetIdx <= currentStageIdx && !finish) return; // don't go backwards

        // Mark all previous as done
        for (let i = 0; i < targetIdx; i++) {
          const el = document.getElementById(STAGE_ORDER[i]);
          el.classList.remove("active");
          el.classList.add("done");
        }

        const el = document.getElementById(targetId);
        if (finish) {
          el.classList.remove("active");
          el.classList.add("done");
        } else {
          el.classList.add("active");
        }

        document.getElementById("progressLabel").textContent = labelText;
        currentStageIdx = targetIdx;
      }

      function resetProgress() {
        currentStageIdx = 0;
        STAGE_ORDER.forEach((id) => {
          document.getElementById(id).classList.remove("active", "done");
        });
        document.getElementById("stage-transfer").classList.add("active");
        const pf = document.getElementById("progressFill");
        pf.style.width = "0%";
        pf.classList.remove("done");
        document.getElementById("progressPct").textContent = "0%";
      }

      document.getElementById("removeBtn").addEventListener("click", clearAll);

      function clearAll() {
        document.getElementById("dropzone").classList.remove("accepted");
        document.getElementById("fileCard").classList.remove("visible");
        document.getElementById("uploadProgress").classList.remove("visible");
        document.getElementById("analyzeBtn").disabled = true;
        document.getElementById("fileInput").value = "";
        document.getElementById("pathInput").value = "";
        document.getElementById("progressFill").style.width = "0%";
        document.getElementById("progressPct").textContent = "0%";
        // Reset stages
        [
          "stage-transfer",
          "stage-validate",
          "stage-index",
          "stage-ready",
        ].forEach((id) => {
          const el = document.getElementById(id);
          el.classList.remove("active", "done");
        });
        document.getElementById("stage-transfer").classList.add("active");
        clearError();
      }

      function startAnalysis() {
        if (!currentSessionId) return;
        const btn = document.getElementById("analyzeBtn");
        btn.classList.add("loading"); // show CSS spinner
        btn.disabled = true;
        // Navigate to analysis page with session ID
        // window.location.href = `/analysis?session=${currentSessionId}`;
        setTimeout(() => {
          btn.classList.remove("loading");
          btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="14" height="14"><polygon points="5 3 19 12 5 21 5 3"/></svg> Begin Analysis`;
          btn.disabled = false;
          alert(`Navigating to /analysis?session=${currentSessionId}`);
        }, 1200);
      }

      function showError(msg) {
        document.getElementById("errorText").textContent = msg;
        document.getElementById("errorMsg").classList.add("visible");
      }

      function clearError() {
        document.getElementById("errorMsg").classList.remove("visible");
      }

      function formatBytes(bytes) {
        if (bytes === 0) return "0 B";
        const k = 1024;
        const sizes = ["B", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }
    </script>
  </body>
</html>
